# 快速部署到 Vercel 指南

## 当前状态
- ✅ 代码已更新（包含完整时间戳优化）
- ✅ `api/feishu/index.js` 已配置
- ✅ `vercel.json` 已配置
- ⚠️ 本地有 10 个提交待推送

## 部署方式

### 方式 1：使用 Vercel CLI 直接部署（推荐，不依赖 GitHub）

如果 `git push` 遇到网络问题，可以直接使用 Vercel CLI 部署：

```bash
cd "/Users/zhaoyuanhao/Documents/cursor/exam index"

# 1. 登录 Vercel（如果还没登录）
npx vercel login

# 2. 部署到生产环境
npx vercel --prod
```

按照提示：
- 选择项目：`exam-index`
- 确认部署：输入 `y`

**优点**：不依赖 GitHub，直接部署，速度快

---

### 方式 2：通过 GitHub 推送（需要网络正常）

如果网络恢复，可以推送代码：

```bash
cd "/Users/zhaoyuanhao/Documents/cursor/exam index"
git push origin main
```

推送后，Vercel 会自动检测并部署。

---

### 方式 3：在 Vercel Dashboard 手动上传

1. 访问 https://vercel.com
2. 进入 `exam-index` 项目
3. 点击 **Deployments** 标签
4. 点击 **"..."** → **"Redeploy"** → 选择最新的部署
5. 或者点击 **Settings** → **Git** → 检查连接状态

---

## 部署后验证

部署完成后，访问你的 Vercel 域名（如 `https://exam-index.vercel.app`），测试：

1. **打开浏览器控制台**（F12）
2. **完成一次答题**
3. **检查控制台日志**：
   - 应该看到 `✅ 保存成功！`
   - 不应该有 `405 Method Not Allowed` 错误
4. **检查飞书表格**：
   - 新数据应该出现在表格中
   - 如果设置了排序，新数据应该在最前面

---

## 如果遇到 405 错误

如果部署后仍然出现 `405 Method Not Allowed`：

1. **检查 Vercel 部署日志**：
   - 进入 Vercel Dashboard → 项目 → 最新部署
   - 查看 **Build Logs** 和 **Runtime Logs**
   - 确认 `api/feishu/index.js` 被识别为 Function

2. **检查 Functions 标签**：
   - 在部署详情页，查看 **Functions** 标签
   - 应该看到 `api/feishu/index.js` 列在函数列表中

3. **验证 `vercel.json`**：
   ```json
   {
     "functions": {
       "api/feishu/index.js": {
         "runtime": "nodejs18.x"
       }
     },
     "rewrites": [
       {
         "source": "/((?!api).*)",
         "destination": "/index.html"
       }
     ]
   }
   ```

4. **如果仍然失败**：
   - 尝试删除 `vercel.json` 中的 `functions` 部分，让 Vercel 自动检测
   - 或者联系我，我们可以尝试其他方案

---

## 当前配置摘要

- **API 路由**：`/api/feishu` → `api/feishu/index.js`
- **运行时**：Node.js 18.x
- **前端**：自动检测环境（本地用 localhost:3000，生产用 /api/feishu）
- **CORS**：已配置，允许所有来源

---

## 推荐操作

**现在立即执行**（如果网络正常）：
```bash
cd "/Users/zhaoyuanhao/Documents/cursor/exam index"
git push origin main
```

**如果网络有问题**：
```bash
cd "/Users/zhaoyuanhao/Documents/cursor/exam index"
npx vercel --prod
```

部署完成后告诉我，我会帮你验证是否成功！
